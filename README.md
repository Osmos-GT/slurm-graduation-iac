# Репозиторий Infrastructure-as-Code для приложения YELB.

Целью построенного в этом репозитарии CI/CD пайплайна является создание инфраструктуры в Yandex cloud и её подготовка для запуска учебного приложения Yelb.

Необходимые для выполнения пайплана переменные указаны в описании [App-репозитория](https://yelbgit.gitlab.yandexcloud.net/yelb/yelb-app)

Пайплайн состоит из следующих этапов:

### Lint
Terraform validate. Также предусмотрен yamllint согласно ТЗ, который выполняется параллельно.

### Build
Создание плана.

### Terraform-deploy
Деплой инфраструктуры. Запуск этапа производится вручную, чтобы можно было изучить созданный на предыдыщем этапе план. Также на этом этапе создается переменная с адресом БД через API Gitlab.  
Все последующие этапы также выполняются вручную, т.к. в них не всегда может быть необходимость (например, не нужно конфигурировать БД, если она не изменяется на этапе деплоя).

### Terraform-destroy-all
Уничтожение инфраструктуры. Удаление переменной с адресом БД через API Gitlab.

### Ingress-install
Установка ingress-контроллера nginx-ingress.
Контроллер будет использовать зарезервированный на этапе деплоя ip-адрес, для которого также автоматически создана dns-запись. 

### Certmanager-install
Установка certmanager и применение манифеста cluster issuer.

### Gitlab-runner-install
Получение токена для регистрации раннера, установка в кластер раннера из локального чарта. Установленный раннер регистрируется в Gitlab.

### Redis-install
Установка Redis.

### Db-prepare
Настройка базы данных: создание в ней таблицы определенной структуры.
